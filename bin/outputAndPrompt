#!/bin/bash

printUsage()
{
    cat <<HELPTEXT
If there's output (with -w|--non-whitespace: output that does contains at least
one non-whitespace character), show PROMPT (with -b|--before: before the output)
and wait for acknowledgement (with -t|--timeout: for TIMEOUT seconds).
If no output is piped into the command, there's no prompt, and the exit status
is 1.
HELPTEXT
    printf 'Usage: cat FILE [...] | %q %s\n' "$(basename "$1")" '[-w|--non-whitespace] [-b|--before] [-t|--timeout TIMEOUT] [PROMPT] [-?|-h|--help]'
}

typeset readArgs=()
typeset -a forwardedArgs=()
while [ $# -ne 0 ]
do
    case "$1" in
	--help|-h|-\?)	shift; printUsage "$0"; exit 0;;
	--non-whitespace|-w|--before|-b)	forwardedArgs+=("$1"); shift;;
	--timeout|-t)	shift; readArgs+=(-t "$1"); shift;;
	--)		shift; break;;
	*)		break;;
    esac
done
if [ $# -gt 1 ]; then
    printUsage "$0" >&2
    exit 2
fi
readArgs+=(-p "${1-Press any key to continue...}")

printf -v quotedReadArgs '%q ' "${readArgs[@]}"; quotedReadArgs=${quotedReadArgs% }
exec outputAnd "${forwardedArgs[@]}" --command "< /dev/tty read -r -s -N 1 $quotedReadArgs; echo"
